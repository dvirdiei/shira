# ğŸš€ ×”× ×•×¡×¢ ×”××ª××™×“ - Backend Structure ×”××œ×

## ğŸ“‹ ×¡×§×™×¨×” ×›×œ×œ×™×ª

×”××¢×¨×›×ª ×¢×‘×™×¨×” ××¢×‘×¨ ××œ× ×œ××‘× ×” ×××•×¨×’×Ÿ ×•××¡×•×“×¨ ×¢× ×”×¤×¨×“×ª ×©×›×‘×•×ª ×‘×¨×•×¨×”. ×›×œ ×§×•×‘×¥ ×•×§×˜×’×•×¨×™×” ×™×© ×œ×” ×ª×¤×§×™×“ ×¡×¤×¦×™×¤×™ ×•×‘×¨×•×¨.

## ğŸ—ï¸ ××‘× ×” ×”×ª×™×§×™×•×ª ×”×—×“×©

```
backend-render/
â”œâ”€â”€ ğŸŒ main.py                      # × ×§×•×“×ª ×›× ×™×¡×” ×¨××©×™×ª
â”œâ”€â”€ ğŸ“ src/                         # ×§×•×“ ×”××§×•×¨ ×”×××•×¨×’×Ÿ
â”‚   â”œâ”€â”€ ğŸ“ api/                     # ×©×›×‘×ª API
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ routes.py               # ×›×œ ×”-endpoints
â”‚   â”‚   â””â”€â”€ handlers.py             # ×× ×”×œ×™ ×‘×§×©×•×ª
â”‚   â”œâ”€â”€ ğŸ“ database/                # ×©×›×‘×ª ×‘×¡×™×¡ × ×ª×•× ×™×
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ connection.py           # ×—×™×‘×•×¨ ×œ×‘×¡×™×¡ ×”× ×ª×•× ×™×
â”‚   â”‚   â”œâ”€â”€ models.py               # ××•×“×œ×™× ×•×¤×•×¨××˜×¨×™×
â”‚   â”‚   â””â”€â”€ queries.py              # ×©××™×œ×ª×•×ª ××•×‘× ×•×ª
â”‚   â”œâ”€â”€ ğŸ“ services/                # ×©×›×‘×ª ×©×™×¨×•×ª×™×
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ address_service.py      # ×©×™×¨×•×ª ×›×ª×•×‘×•×ª
â”‚   â”‚   â”œâ”€â”€ geocoding_service.py    # ×©×™×¨×•×ª ×’×™××•×§×•×“×™× ×’
â”‚   â”‚   â””â”€â”€ data_service.py         # ×©×™×¨×•×ª × ×ª×•× ×™×
â”‚   â””â”€â”€ ğŸ“ utils/                   # ×›×œ×™ ×¢×–×¨
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ validators.py           # ×××ª× ×™×
â”‚       â”œâ”€â”€ formatters.py           # ×¤×•×¨××˜×¨×™×
â”‚       â”œâ”€â”€ rate_limiter.py         # ××’×‘×™×œ ×§×¦×‘
â”‚       â””â”€â”€ helpers.py              # ×¢×–×¨×™× ×›×œ×œ×™×™×
â”œâ”€â”€ ğŸ“ database/                    # ×§×‘×¦×™ SQL
â”œâ”€â”€ ğŸ“ scripts/                     # ×¡×§×¨×™×¤×˜×™×
â”œâ”€â”€ ğŸ“ tests/                       # ×‘×“×™×§×•×ª
â”œâ”€â”€ ğŸ“ docs/                        # ×ª×™×¢×•×“
â””â”€â”€ ğŸ“ PYTHON/                      # ×§×‘×¦×™× ×™×©× ×™× (×œ××¨×›×™×•×Ÿ)
```

## ğŸ¯ ×§×˜×’×•×¨×™×•×ª ×•×ª×¤×§×™×“×™×

### 1. ğŸŒ API Layer (src/api/)
**×ª×¤×§×™×“**: ×× ×”×œ ××ª ×›×œ ×”-endpoints ×•×”-HTTP requests

- **routes.py**: ××’×“×™×¨ ××ª ×›×œ ×”-endpoints ×¢× ××¨×’×•×Ÿ ×œ×•×’×™
- **handlers.py**: ××›×™×œ 4 ×§×˜×’×•×¨×™×•×ª ×©×œ handlers:
  - `AddressHandlers`: × ×™×”×•×œ ×›×ª×•×‘×•×ª
  - `GeocodingHandlers`: ×’×™××•×§×•×“×™× ×’
  - `DataHandlers`: × ×™×”×•×œ × ×ª×•× ×™×
  - `SystemHandlers`: ××¢×¨×›×ª ×•×‘×“×™×§×•×ª

### 2. ğŸ“Š Database Layer (src/database/)
**×ª×¤×§×™×“**: ×× ×”×œ ××ª ×›×œ ×”×—×™×‘×•×¨×™× ×•×©××™×œ×ª×•×ª ×œ×‘×¡×™×¡ ×”× ×ª×•× ×™×

- **connection.py**: ×—×™×‘×•×¨ ×œ-Supabase
- **models.py**: ××•×“×œ×™×, ×××ª× ×™× ×•×¤×•×¨××˜×¨×™×
- **queries.py**: ×›×œ ×”×©××™×œ×ª×•×ª ×”××•×‘× ×•×ª

### 3. ğŸ”§ Services Layer (src/services/)
**×ª×¤×§×™×“**: ××›×™×œ ××ª ×›×œ ×”×œ×•×’×™×§×” ×”×¢×¡×§×™×ª

- **address_service.py**: × ×™×”×•×œ ×›×ª×•×‘×•×ª
- **geocoding_service.py**: ×”××¨×ª ×›×ª×•×‘×•×ª ×œ×§×•××•×¨×“×™× ×˜×•×ª
- **data_service.py**: × ×™×”×•×œ × ×ª×•× ×™×, ×¡×˜×˜×™×¡×˜×™×§×•×ª, ×’×™×‘×•×™×™×

### 4. ğŸ› ï¸ Utils Layer (src/utils/)
**×ª×¤×§×™×“**: ×›×œ×™ ×¢×–×¨ ×›×œ×œ×™×™×

- **validators.py**: ×××ª× ×™× ×œ×›×œ ×¡×•×’×™ ×”× ×ª×•× ×™×
- **formatters.py**: ×¤×•×¨××˜×¨×™× ×œ×ª×¦×•×’×”
- **rate_limiter.py**: ××’×‘×™×œ ×§×¦×‘ ×‘×§×©×•×ª
- **helpers.py**: ×¢×–×¨×™× ×›×œ×œ×™×™× ×•×¤×•× ×§×¦×™×•×ª ×©×™××•×©×™×•×ª

## ğŸ“ ××™×¤×•×™ Endpoints

### ğŸ  Address Endpoints
```
GET  /api/addresses              # ×›×œ ×”×›×ª×•×‘×•×ª
GET  /api/addresses-array        # ×›××¢×¨×š ×¤×©×•×˜
GET  /api/all-addresses         # ×¢× ××™×“×¢ ××¤×•×¨×˜
GET  /api/missing-coordinates   # ×‘×œ×™ ×§×•××•×¨×“×™× ×˜×•×ª
POST /api/add-address           # ×”×•×¡×¤×ª ×›×ª×•×‘×ª
POST /api/toggle-visited        # ×”×—×œ×¤×ª ×¡×˜×˜×•×¡ ×‘×™×§×•×¨
POST /api/delete-address        # ××—×™×§×ª ×›×ª×•×‘×ª
```

### ğŸ—ºï¸ Geocoding Endpoints
```
POST /api/batch-geocode         # ×”×•×¡×¤×ª ×›×ª×•×‘×•×ª ×¢× ×’×™××•×§×•×“×™× ×’
POST /api/retry-geocoding       # × ×™×¡×™×•×Ÿ ×—×•×–×¨
```

### ğŸ“Š Data Management Endpoints
```
GET  /api/statistics            # ×¡×˜×˜×™×¡×˜×™×§×•×ª
POST /api/reset-data           # ××™×¤×•×¡ × ×ª×•× ×™×
POST /api/reset-all-data       # ××™×¤×•×¡ ××œ×
```

### âš™ï¸ System Endpoints
```
GET  /api/health               # ×‘×“×™×§×ª ×ª×§×™× ×•×ª
GET  /api/test-connection      # ×‘×“×™×§×ª ×—×™×‘×•×¨
GET  /api/info                 # ××™×“×¢ ×¢×œ ×”××¢×¨×›×ª
```

## ğŸ”„ ×–×¨×™××ª ×”××™×“×¢

```
1. Browser Request â†’ routes.py
2. routes.py â†’ handlers.py (×œ×¤×™ ×§×˜×’×•×¨×™×”)
3. handlers.py â†’ services/ (×œ×•×’×™×§×” ×¢×¡×§×™×ª)
4. services/ â†’ database/queries.py (×©××™×œ×ª×•×ª)
5. queries.py â†’ database/connection.py (×—×™×‘×•×¨)
6. ×—×–×¨×” ×¢× ×ª×•×¦××•×ª ××¢×•×¦×‘×•×ª
```

## ğŸ’¡ ×™×ª×¨×•× ×•×ª ×”××‘× ×” ×”×—×“×©

### ğŸ¯ **×”×¤×¨×“×ª ×ª×¤×§×™×“×™× ×‘×¨×•×¨×”**
- ×›×œ ×©×›×‘×” ×™×© ×œ×” ×ª×¤×§×™×“ ×¡×¤×¦×™×¤×™
- ×§×œ ×œ×ª×—×–×§ ×•×œ×¢×“×›×Ÿ
- ××•× ×¢ ×¢×¨×‘×•×‘ ×§×•×“

### ğŸ”§ **×§×œ×•×ª ×ª×—×–×•×§×”**
- ×§×•×‘×¥ ××—×“ = ×ª×¤×§×™×“ ××—×“
- ×§×œ ×œ××¦×•× ×•×œ×ª×§×Ÿ ×©×’×™××•×ª
- ×ª×™×¢×•×“ ××¤×•×¨×˜ ×‘×›×œ ×§×•×‘×¥

### ğŸ“ˆ **××“×¨×’×•×ª**
- ×§×œ ×œ×”×•×¡×™×£ ×ª×›×•× ×•×ª ×—×“×©×•×ª
- ××‘× ×” ×™×›×•×œ ×œ×’×“×•×œ ×‘×§×œ×•×ª
- ×ª××™×›×” ×‘×¤×¨×™×˜×™× ××•×¨×›×‘×™×

### ğŸ›¡ï¸ **××‘×˜×—×”**
- ××™××•×ª×™× ×‘×›×œ ×©×›×‘×”
- ×”×’×‘×œ×ª ×§×¦×‘ ×‘×§×©×•×ª
- ×‘×“×™×§×•×ª ×ª×§×™× ×•×ª

### ğŸ§ª **×‘×“×™×§×•×ª**
- ×›×œ ×©×›×‘×” × ×™×ª× ×ª ×œ×‘×“×™×§×”
- ×§×œ ×œ×›×ª×•×‘ unit tests
- ××‘× ×” ×ª×•××š ×‘TDD

## ğŸš€ ×›×™×¦×“ ×œ×”×©×ª××©

### ×”×•×¡×¤×ª ×›×ª×•×‘×ª ×—×“×©×”:
1. **Frontend** ×©×•×œ×— POST ×œ-`/api/add-address`
2. **routes.py** ××¤× ×” ×œ-`AddressHandlers.add_single_address()`
3. **handlers.py** ×§×•×¨× ×œ-`AddressService.add_single_address()`
4. **address_service.py** ××××ª × ×ª×•× ×™× ×•××¤× ×” ×œ-`AddressQueries.insert_address()`
5. **queries.py** ××‘×¦×¢ ×”×©××™×œ×ª×” ×“×¨×š `connection.py`
6. ×”×ª×•×¦××” ×—×•×–×¨×ª ××¢×•×¦×‘×ª ×¢× **AddressFormatter**

### ×”×•×¡×¤×ª ×ª×›×•× ×” ×—×“×©×”:
1. ×”×•×¡×£ endpoint ×‘-**routes.py**
2. ×”×•×¡×£ handler ×‘-**handlers.py**
3. ×”×•×¡×£ ×©×™×¨×•×ª ×‘-**services/**
4. ×”×•×¡×£ ×©××™×œ×ª×” ×‘-**queries.py**
5. ×”×•×¡×£ ×‘×“×™×§×•×ª ×‘-**tests/**

## ğŸ“š ×ª×™×¢×•×“ × ×•×¡×£

- **API Documentation**: `docs/api.md`
- **Database Schema**: `docs/database.md`
- **Services Guide**: `docs/services.md`
- **Deployment Guide**: `docs/deployment.md`

## ğŸ”§ ×¤×™×ª×•×—

### ×”×ª×§× ×”:
```bash
cd backend-render
pip install -r requirements.txt
```

### ×”×¨×¦×”:
```bash
python main.py
```

### ×‘×“×™×§×•×ª:
```bash
python -m pytest tests/
```

## ğŸ‰ ×”××¢×¨×›×ª ××•×›× ×”!

×”××‘× ×” ×”×—×“×© ××¡×¤×§:
- âœ… ××¨×’×•×Ÿ ××•×©×œ×
- âœ… ×§×œ×•×ª ×¤×™×ª×•×—
- âœ… ×™×¦×™×‘×•×ª ×’×‘×•×”×”
- âœ… ××“×¨×’×•×ª ×§×œ×”
- âœ… ×ª×—×–×•×§×” ×¤×©×•×˜×”

×›×œ ×”×§×•×“ ×××•×¨×’×Ÿ ×œ×¤×™ ×”×’×™×•×Ÿ ×¢×¡×§×™ ×‘×¨×•×¨, ×•×›×œ ××¤×ª×— ×™×•×›×œ ×œ×”×‘×™×Ÿ ×‘××”×™×¨×•×ª ××” ×›×œ ×—×œ×§ ×¢×•×©×”! ğŸš€
